<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/detail.css/">

    <title>ìƒì„¸ ë ˆì‹œí”¼ í˜ì´ì§€</title>
    <script>

        $(document).ready(function () {
        // ë ˆì‹œí”¼ ì´ë¦„ urlì—ì„œ ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get("recipe_name");
            // console.log(name)

            $.ajax({
                type: "GET",
                url: `/detail/recipe-detail?recipe_name=${name}`,
                data: {},
                success: function (response) {

                    let targetRecipe = response['target_recipe']
                    // console.log(targetRecipe)

                    let recipeName = targetRecipe['recipe_name']
                    let recipeImg = targetRecipe['recipe_img']
                    let recipeIngs = targetRecipe['recipe_ing']
                    let recipeDiff = targetRecipe['recipe_diff']
                    let recipeTime = targetRecipe['recipe_time']
                    let recipeDetails = targetRecipe['recipe_detail']
                    let recipeLike = targetRecipe['recipe_like']
                    let recipeWritter = targetRecipe['recipe_writter']
                    // console.log(recipeName, recipeImg, recipeIngs, recipeDiff, recipeTime, recipeDetails, recipeLike, recipeWritter)

            // ë ˆì‹œí”¼ ì´ë¯¸ì§€, ë ˆì‹œí”¼ íƒ€ì´í‹€ ë°•ìŠ¤, ë ˆì‹œí”¼ íƒ­ì˜ ì•„ì´ì½˜ ë°•ìŠ¤ append
                    temp_html = `<img class="recipe_img" src="${recipeImg}">`
                    temp_html2 = `<span class="recipe_name" id="name">${recipeName}</span><br>
                                  <span class="recipe_writter" id="writter">${recipeWritter}</span><br>
                                  <span class="recipe_diff"><img src="/static/img/diffIcon.png" class="diffIcon">${recipeDiff}</span><br>
                                  <div class="recipe_add">
                                      <button type="button" id="bookmarkBtn"><img src="/static/img/addIcon.png" class="addIcon"></button>
                                      <p class="arrow_box">ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€!</p>
                                  </div>
                                  <span class="recipe_like"><img src="/static/img/likeIcon.png" class="likeIcon">${recipeLike}</span>`

                    temp_html3 = `<div class="timeIconWrap">
                                      <img src="/static/img/timeIcon.png" class="timeIcon">
                                      <span class="timeBox">${recipeTime}</span>
                                  </div>
                                  <div class="diff2IconWrap">
                                      <img src="/static/img/3starsIcon.png" class="diff2Icon">
                                      <span class="diff2Box">${recipeDiff}</span>
                                  </div>`

                    $('#imgWrap').append(temp_html)
                    $('#titleWrap').append(temp_html2)
                    $('#iconWrap').append(temp_html3)

            // ë ˆì‹œí”¼ ì¡°ë¦¬ê³¼ì • append
                    let recipeDetail = recipeDetails.split("\n");
                    // console.log(recipeDetail)

                    for(let i = 0; i < recipeDetail.length; i++) {
                        let detail = recipeDetail[i];
                        // console.log(detail)

                        temp_html4 = `<li class="process">${detail}</li>`

                        $('#processList').append(temp_html4)

                    }
            // ë ˆì‹œí”¼ ì¬ë£Œ append
                    let recipeIng = recipeIngs.split("\n");
                    // console.log(recipeIng)

                    for(let i = 0; i < recipeIng.length; i++) {
                        let Ing = recipeIng[i];
                        // console.log(detail)

                        temp_html5 = `<li class="ingredient">${Ing}</li>`

                        $('#ingList').append(temp_html5)
                    }
                    }

            })

        // ë¦¬ë·° ë“±ë¡í•˜ê¸°(create ê¸°ëŠ¥) ajax
            $(document).on('click', '#reviewPostBtn', function () {
                    let nickName = sessionStorage.getItem("user_nickname")
                    let content = $('#reviewInput').val()
                    console.log(nickName, content)

                    $.ajax({
                        type: "POST",
                        url: '/detail/review-post',
                        data: {user_nickname_give: nickName, review_content_give:content, recipe_name_give: name},
                        success: function (response) { // ì„±ê³µí•˜ë©´
                            let answer = response["msg"]
                            alert(answer);
                            location.reload();
                        }

                    })

            })

        // ë¦¬ë·° ë¦¬ìŠ¤íŒ… ê¸°ëŠ¥ ajax
            $.ajax({
                type: "GET",
                url: `/detail/review-list?recipe_name=${name}`,
                data: {},
                success: function (response) {
                    let reviews = response['reviews']
                    // console.log(reviews)

                    for (let i = 0; i < reviews.length; i++) {
                        let reviewContent = reviews[i]['review_content']
                        let nickName = reviews[i]['user_nickname']
                        let reviewUpdate = reviews[i]['review_update']

                        // console.log(reviewContent, nickName, reviewUpdate)

                        temp_html = `<div class="reviewList">
                                        <span class="userName">ì‘ì„±ì: ${nickName}</span>
                                        <span class="reviewDate">${reviewUpdate}</span>
                                        <span class="review">${reviewContent}</span>
                                    </div>`

                        $('#reviewList').append(temp_html)
                    }



                }
            })


        })

    // ì¦ê²¨ì°¾ê¸° ì¶”ê°€ ê¸°ëŠ¥ ajax
        $(document).on('click','#bookmarkBtn', function() {
                $.ajax({
                    type: "POST",
                    url: "/detail/bookmark",
                    data: {},
                    success: function (response) { // ì„±ê³µí•˜ë©´
                        alert(response["msg"]);
                        window.location.reload();
                    }
                 })
            } )






    </script>
</head>
<body>
    <nav class="naviBar">
        <ul>
            <li><a class="logoLink" href="/"><img class="logoIcon" src="/static/img/logo.png"></a></li>
            <li><a class="menuLink" href="/list">ì „ì²´ ë ˆì‹œí”¼ ë³´ê¸°</a></li>
            <li><a class="menuLink" href="/rank">ë­í‚¹ ë³´ê¸°</a></li>
            <li><a class="menuLink" href="/write">ë‚˜ë§Œì˜ ë ˆì‹œí”¼</a></li>
            <li><a class="menuLink" href="/mypage">ë§ˆì´í˜ì´ì§€</a></li>
            <li><a class="myPageLink" href="/login"><img src="/static/img/myPageIcon.png" class="loginIcon"></a></li>
        </ul>
    </nav>

    <div class="wrap">
        <div class="detailWrap">
            <div class="detailImgWrap" id="imgWrap">
<!--                ë ˆì‹œí”¼ ì´ë¯¸ì§€ ë“¤ì–´ê°€ëŠ” ë¶€ë¶„-->
            </div>
            <div class="detailTitleWrap" id="titleWrap">
<!--                ë ˆì‹œí”¼ íƒ€ì´í‹€ ë°•ìŠ¤ ë“¤ì–´ê°€ëŠ” ë¶€ë¶„-->
            </div>
            <div class="imforWrap">
                <div class="container">
                    <div class="sortBar">
                        <ul class="tabs">
                            <li class="recipeSort current" data-tab="tab-1">ë ˆì‹œí”¼</li>
                            <li class="recipeSort" data-tab="tab-2">ì¡°ë¦¬ê³¼ì •</li>
                            <li class="recipeSort" data-tab="tab-3">ë¦¬ë·°</li>
                        </ul>
                    </div>
                    <div class="contentWrap">
                        <div id="tab-1" class="tabContent current">
                            <div class="iconWrap" id="iconWrap">
<!--                                ì¡°ë¦¬ì‹œê°„, ë‚œì´ë„ ì•„ì´ì½˜ ë“¤ì–´ê°€ëŠ” ì •ë³´ ë°•ìŠ¤ ë¶€ë¶„-->
                            </div>
                            <div class="ingredientWrap">
                                <span class="ingTitle">ğŸ“Œ ìµœì†Œí•œ ì´ê±´ ì¤€ë¹„í•˜ì!</span>
                                <ul class="ingList" id="ingList">
<!--                                    ë ˆì‹œí”¼ ì¬ë£Œ ë“¤ì–´ê°€ëŠ” ë¶€ë¶„-->
                                </ul>
                            </div>
                        </div>
                        <div id="tab-2" class="tabContent">
                            <div class="processWrap">
                                <span class="processTitle">ğŸ“Œ ì´ì •ëˆ ë§Œë“¤ ìˆ˜ ìˆë‹¤!</span>
                                <ul class="processList" id="processList">
<!--                                    ë ˆì‹œí”¼ ì¡°ë¦¬ê³¼ì • ë“¤ì–´ê°€ëŠ” ë¶€ë¶„-->
                                </ul>
                            </div>
                        </div>
                        <div id="tab-3" class="tabContent">
                            <div class="reviewWrap">
                                <span class="reviewTitle">ğŸ“Œ ë‚˜ë„ ë§Œë“¤ì—ˆë‹¤! ë‚´ê°€ ë§Œë“  ìš”ë¦¬ í›„ê¸°</span>
                                <div class="reviewWrite">
                                    <input type="text" placeholder="í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!" class="reviewInput" id="reviewInput">
                                    <button type="button" class="reviewBtn" id="reviewPostBtn">ë“±ë¡</button>
                                </div>
                                <hr class="line">
                                <div class="reviewListWrap" id="reviewList">
<!--                                    ë¦¬ë·° List ë“¤ì–´ê°€ëŠ” ë¶€ë¶„-->
                                </div>

                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>


    </div>
    <script type="text/javascript" src="/static/js/detail.js/"></script>
</body>
